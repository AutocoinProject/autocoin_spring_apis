name: SSH Key Troubleshooting

on:
  workflow_dispatch:

jobs:
  create-new-ssh-key:
    runs-on: ubuntu-latest
    steps:
      - name: Generate New SSH Key Pair
        run: |
          # ìƒˆë¡œìš´ SSH í‚¤ í˜ì–´ ìƒì„±
          ssh-keygen -t rsa -b 4096 -f ./new_ec2_key -N ""
          
          echo "=== ìƒˆë¡œìš´ Public Key ==="
          cat ./new_ec2_key.pub
          echo ""
          echo "=== ìƒˆë¡œìš´ Private Key ==="
          cat ./new_ec2_key
          
          echo ""
          echo "ğŸ”§ ì„¤ì • ë°©ë²•:"
          echo "1. ìœ„ì˜ Public Keyë¥¼ ë³µì‚¬"
          echo "2. EC2 ì¸ìŠ¤í„´ìŠ¤ì— SSHë¡œ ì ‘ì†"
          echo "3. ~/.ssh/authorized_keysì— Public Key ì¶”ê°€"
          echo "4. GitHub Secrets EC2_SSH_KEYì— Private Key ì„¤ì •"

  test-current-key:
    runs-on: ubuntu-latest
    steps:
      - name: Test Current SSH Key Format
        run: |
          echo "í˜„ì¬ ì„¤ì •ëœ SSH í‚¤ í…ŒìŠ¤íŠ¸"
          echo "${{ secrets.EC2_SSH_KEY }}" > test_key
          chmod 600 test_key
          
          # SSH í‚¤ í˜•ì‹ ê²€ì¦
          ssh-keygen -l -f test_key || echo "âŒ SSH í‚¤ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤"
          
          # SSH í‚¤ ì •ë³´ ì¶œë ¥
          ssh-keygen -y -f test_key || echo "âŒ SSH í‚¤ì—ì„œ public keyë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"

  direct-docker-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Alternative - Direct Docker Deployment
        run: |
          echo "SSH ì—†ì´ EC2ì— ì§ì ‘ ë°°í¬í•˜ëŠ” ëŒ€ì•ˆ:"
          echo "1. GitHub Actionsì—ì„œ Docker ì´ë¯¸ì§€ ë¹Œë“œ âœ…"
          echo "2. EC2ì—ì„œ cron jobìœ¼ë¡œ ìµœì‹  ì´ë¯¸ì§€ ìë™ pull"
          echo "3. ë˜ëŠ” AWS CodeDeploy ì‚¬ìš©"
          echo "4. ë˜ëŠ” AWS ECS/Fargateë¡œ ì´ì „"
