global:
  # SMTP ì„¤ì • (ì´ë©”ì¼ ì•Œë¦¼ìš©)
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@autocoin.com'
  smtp_auth_username: 'alerts@autocoin.com'
  smtp_auth_password: ''
  
  # Slack ì„¤ì •ì„ ìœ„í•œ ê¸€ë¡œë²Œ í…œí”Œë¦¿
  slack_api_url: '{{ .SlackWebhookURL }}'

# ì•Œë¦¼ ë¼ìš°íŒ… ê·œì¹™
route:
  # ê·¸ë£¹í•‘ ê¸°ì¤€
  group_by: ['alertname', 'service', 'severity']
  
  # ê·¸ë£¹í•‘ ëŒ€ê¸° ì‹œê°„ (ìƒˆ ì•Œë¦¼ì„ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„)
  group_wait: 30s
  
  # ê·¸ë£¹í•‘ ê°„ê²© (ê°™ì€ ê·¸ë£¹ì˜ í›„ì† ì•Œë¦¼ ì „ì†¡ ê°„ê²©)
  group_interval: 5m
  
  # ë°˜ë³µ ì•Œë¦¼ ê°„ê²©
  repeat_interval: 4h
  
  # ê¸°ë³¸ ë¦¬ì‹œë²„
  receiver: 'default-notifications'
  
  # ì‹¬ê°ë„ë³„ ë¼ìš°íŒ… ê·œì¹™
  routes:
    # Critical ì•Œë¦¼ - ì¦‰ì‹œ Slack ì „ì†¡
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      group_interval: 1m
      repeat_interval: 30m
      
    # Warning ì•Œë¦¼ - ì¼ë°˜ Slack ì±„ë„
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 1m
      group_interval: 5m
      repeat_interval: 2h
      
    # Info ì•Œë¦¼ - ì •ë³´ì„± ì•Œë¦¼
    - match:
        severity: info
      receiver: 'info-alerts'
      group_wait: 5m
      group_interval: 15m
      repeat_interval: 12h
      
    # íŠ¹ì • ì„œë¹„ìŠ¤ë³„ ë¼ìš°íŒ…
    - match:
        service: autocoin-api
      receiver: 'api-alerts'
      
    - match:
        service: mysql
      receiver: 'database-alerts'
      
    - match:
        service: system
      receiver: 'system-alerts'

# ì•Œë¦¼ ìˆ˜ì‹ ì ì„¤ì •
receivers:
  # ê¸°ë³¸ ì•Œë¦¼ ìˆ˜ì‹ ì
  - name: 'default-notifications'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#alerts'
        title: 'ğŸš¨ Autocoin Alert'
        text: |
          *Service:* {{ range .Alerts }}{{ .Labels.service }}{{ end }}
          *Severity:* {{ range .Alerts }}{{ .Labels.severity }}{{ end }}
          *Summary:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Description:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          
          *Time:* {{ .CommonLabels.alertname }} started at {{ .CommonAnnotations.timestamp }}
        send_resolved: true
        
  # Critical ì•Œë¦¼ (ì¦‰ì‹œ ëŒ€ì‘ í•„ìš”)
  - name: 'critical-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#critical-alerts'
        username: 'AlertBot'
        icon_emoji: ':fire:'
        title: 'ğŸ”¥ CRITICAL ALERT - Immediate Action Required'
        title_link: 'https://monitoring.autocoin.com'
        color: 'danger'
        text: |
          *ğŸš¨ CRITICAL ISSUE DETECTED ğŸš¨*
          
          *Service:* {{ range .Alerts }}{{ .Labels.service | toUpper }}{{ end }}
          *Alert:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          
          *Instance:* {{ range .Alerts }}{{ .Labels.instance }}{{ end }}
          *Started:* {{ range .Alerts }}{{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}{{ end }}
          
          <!channel> ê¸´ê¸‰ ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤!
          
          *Quick Actions:*
          â€¢ [View Grafana Dashboard](https://monitoring.autocoin.com)
          â€¢ [Check Logs](https://monitoring.autocoin.com/logs)
          â€¢ [System Status](https://status.autocoin.com)
        actions:
          - type: button
            text: 'View Dashboard'
            url: 'https://monitoring.autocoin.com'
        send_resolved: true
        
  # Warning ì•Œë¦¼
  - name: 'warning-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#alerts'
        username: 'AlertBot'
        icon_emoji: ':warning:'
        title: 'âš ï¸ Warning Alert'
        color: 'warning'
        text: |
          *âš ï¸ Warning Detected*
          
          *Service:* {{ range .Alerts }}{{ .Labels.service }}{{ end }}
          *Alert:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          
          *Instance:* {{ range .Alerts }}{{ .Labels.instance }}{{ end }}
          *Started:* {{ range .Alerts }}{{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}{{ end }}
        send_resolved: true
        
  # Info ì•Œë¦¼ (ì •ë³´ì„±)
  - name: 'info-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#general'
        username: 'InfoBot'
        icon_emoji: ':information_source:'
        title: 'â„¹ï¸ Information Alert'
        color: 'good'
        text: |
          *â„¹ï¸ System Information*
          
          *Service:* {{ range .Alerts }}{{ .Labels.service }}{{ end }}
          *Info:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: false
        
  # API ì„œë¹„ìŠ¤ ì „ìš© ì•Œë¦¼
  - name: 'api-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#api-alerts'
        username: 'API-AlertBot'
        icon_emoji: ':gear:'
        title: 'ğŸ”§ API Service Alert'
        color: '{{ if eq (index .Alerts 0).Labels.severity "critical" }}danger{{ else if eq (index .Alerts 0).Labels.severity "warning" }}warning{{ else }}good{{ end }}'
        text: |
          *ğŸ”§ API Service Issue*
          
          *Alert:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          *Severity:* {{ range .Alerts }}{{ .Labels.severity | toUpper }}{{ end }}
          
          *Runbook:* {{ range .Alerts }}{{ .Annotations.runbook_url }}{{ end }}
          
          *Quick Health Check:*
          ```
          curl -sf https://api.autocoin.com/actuator/health
          ```
        send_resolved: true
        
  # ë°ì´í„°ë² ì´ìŠ¤ ì „ìš© ì•Œë¦¼
  - name: 'database-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#database-alerts'
        username: 'DB-AlertBot'
        icon_emoji: ':floppy_disk:'
        title: 'ğŸ’¾ Database Alert'
        color: '{{ if eq (index .Alerts 0).Labels.severity "critical" }}danger{{ else }}warning{{ end }}'
        text: |
          *ğŸ’¾ Database Issue Detected*
          
          *Service:* {{ range .Alerts }}{{ .Labels.service | toUpper }}{{ end }}
          *Alert:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          
          *Quick Actions:*
          â€¢ Check database connections
          â€¢ Review slow query log
          â€¢ Monitor resource usage
        send_resolved: true
        
  # ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì „ìš© ì•Œë¦¼
  - name: 'system-alerts'
    slack_configs:
      - api_url: '{{ .SlackWebhookURL }}'
        channel: '#system-alerts'
        username: 'System-AlertBot'
        icon_emoji: ':computer:'
        title: 'ğŸ’» System Resource Alert'
        color: '{{ if eq (index .Alerts 0).Labels.severity "critical" }}danger{{ else }}warning{{ end }}'
        text: |
          *ğŸ’» System Resource Issue*
          
          *Host:* {{ range .Alerts }}{{ .Labels.instance }}{{ end }}
          *Alert:* {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
          *Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
          
          *System Commands:*
          ```
          # Check system status
          system-status
          
          # Cleanup if needed
          cleanup-system
          ```
        send_resolved: true

# ì•Œë¦¼ ì–µì œ ê·œì¹™ (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€)
inhibit_rules:
  # Critical ì•Œë¦¼ì´ ìˆìœ¼ë©´ Warning ì•Œë¦¼ ì–µì œ
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service', 'instance']
    
  # API ë‹¤ìš´ ì‹œ ëª¨ë“  API ê´€ë ¨ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'AutocoinAPIDown'
    target_match_re:
      alertname: 'Autocoin.*'
    equal: ['service']
    
  # ì‹œìŠ¤í…œ ë‹¤ìš´ ì‹œ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'InstanceDown'
    target_match_re:
      alertname: '.*'
    equal: ['instance']

# ê¸€ë¡œë²Œ í…œí”Œë¦¿ (ì„ íƒì‚¬í•­)
templates:
  - '/etc/alertmanager/templates/*.tmpl'
